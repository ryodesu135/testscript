local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Lights Hub",
    LoadingTitle = "Loading Lights Hub",
    LoadingSubtitle = "by Ryo",
    Theme = "Default",
    ToggleUIKeybind = "K",
    KeySystem = false
})

-- ğŸ§  åˆå§‹åŒ–å…¨å±€å˜é‡
getgenv().UserSetWalkSpeed = nil
getgenv().UserSetJumpPower = nil
getgenv().SpeedMonitorRunning = false

-- âœ… æ•æ‰å½“å‰è§’è‰² WalkSpeed / JumpPower
local player = game.Players.LocalPlayer

local function captureCurrentStats()
    local char = player.Character or player.CharacterAdded:Wait()
    local humanoid = char:WaitForChild("Humanoid")
    getgenv().CurrentWalkSpeed = humanoid.WalkSpeed
    getgenv().CurrentJumpPower = humanoid.JumpPower
    print("[DEBUG] æ•æ‰å½“å‰é€Ÿåº¦:", getgenv().CurrentWalkSpeed, " è·³è·ƒåŠ›:", getgenv().CurrentJumpPower)
end

-- âœ… ç»´æŒè®¾å®šçš„é€Ÿåº¦ä¸è·³è·ƒåŠ›
task.spawn(function()
    getgenv().SpeedMonitorRunning = true
    while getgenv().SpeedMonitorRunning do
        pcall(function()
            local char = player.Character
            local humanoid = char and char:FindFirstChild("Humanoid")
            if humanoid then
                if getgenv().UserSetWalkSpeed and humanoid.WalkSpeed ~= getgenv().UserSetWalkSpeed then
                    humanoid.WalkSpeed = getgenv().UserSetWalkSpeed
                end
                if getgenv().UserSetJumpPower and humanoid.JumpPower ~= getgenv().UserSetJumpPower then
                    humanoid.JumpPower = getgenv().UserSetJumpPower
                end
            end
        end)
        task.wait(0.3)
    end
end)

--ğŸ  Main Tab
local MainTab = Window:CreateTab("ğŸ  | Main", nil)
local MainSection = MainTab:CreateSection("Main")

-- âœ… WalkSpeed Slider
local SpeedSlider = MainTab:CreateSlider({
    Name = "Walk Speed",
    Range = {30, 150},
    Increment = 1,
    Suffix = "Speed",
    CurrentValue = getgenv().CurrentWalkSpeed or 35,
    Flag = "Slider1",
    Callback = function(Value)
        local char = player.Character
        local humanoid = char and char:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = Value
            getgenv().UserSetWalkSpeed = Value
            print("[DEBUG] ç©å®¶è®¾å®š WalkSpeed:", Value)
        end
    end,
})

-- âœ… JumpPower Slider
local HeightSlider = MainTab:CreateSlider({
    Name = "Jump Height",
    Range = {50, 200},
    Increment = 1,
    Suffix = "Height",
    CurrentValue = getgenv().CurrentJumpPower or 50,
    Flag = "Slider2",
    Callback = function(Value)
        local char = player.Character
        local humanoid = char and char:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.JumpPower = Value
            getgenv().UserSetJumpPower = Value
            print("[DEBUG] ç©å®¶è®¾å®š JumpPower:", Value)
        end
    end,
})

--ğŸ›¡ï¸ Anti AFK
local bb = game:service'VirtualUser'
local afkConnection
local Toggle = MainTab:CreateToggle({
    Name = "Anti AFK",
    CurrentValue = false,
    Flag = "Toggle1",
    Callback = function(Value)
        if Value then
            game:GetService("ReplicatedStorage").Events.To_Server:FireServer({
                ["Value"] = false,
                ["Path"] = {"Settings", "AFK_MODE"},
                ["Action"] = "Settings",
            })
            afkConnection = player.Idled:Connect(function()
                bb:CaptureController()
                bb:ClickButton2(Vector2.new())
                wait(2)
            end)
        else
            if afkConnection then
                afkConnection:Disconnect()
                afkConnection = nil
            end
        end
    end,
})

-- âœ… Auto Rank Up
local AutoRankUpToggle = MainTab:CreateToggle({
    Name = "Auto Rank Up",
    CurrentValue = false,
    Flag = "RankUp1",
    Callback = function(Value)
        if Value then
            getgenv().AutoRankUpRunning = true
            task.spawn(function()
                while getgenv().AutoRankUpRunning do
                    pcall(function()
                        game:GetService("ReplicatedStorage").Events.To_Server:FireServer({
                            ["Upgrading_Name"] = "Rank",
                            ["Action"] = "_Upgrades",
                            ["Upgrade_Name"] = "Rank_Up",
                        })
                    end)
                    task.wait(10)
                end
            end)
        else
            getgenv().AutoRankUpRunning = false
        end
    end,
})

--ğŸŒ¾ Farm Tab
local mobNames = {}
local mobMap = {}
local selectedMobs = {}
local farmReplicaConnection = nil
getgenv().AutoFarmRunning = false
getgenv().FarmTargetChanged = false

local FarmTab = Window:CreateTab("ğŸŒ¾ | Farm", nil)
local FarmSection = FarmTab:CreateSection("Farm")
local rootPart = game.Players.LocalPlayer.Character:WaitForChild("HumanoidRootPart")

-- âœ… Dropdown é€‰æ‹©å˜åŒ–æ—¶ç«‹å³è§¦å‘åˆ‡æ¢
local AutoFarmMobsListDropdown = FarmTab:CreateDropdown({
    Name = "Mobs List",
    Options = {"None"},
    CurrentOption = {"None"},
    MultipleOptions = true,
    Flag = "Dropdown1",
    Callback = function(Options)
        selectedMobs = Options or {}
        getgenv().FarmTargetChanged = true -- âœ… è§¦å‘é‡æ–°ç›®æ ‡
        print("[DEBUG] ğŸ¯ Mob target changed:", table.concat(selectedMobs, ", "))
    end,
})

-- âœ… åˆ·æ–°æŒ‰é’®
local ScanMobsButton = FarmTab:CreateButton({
    Name = "Refresh Mobs List",
    Callback = function()
        mobNames = {}
        mobMap = {}
        selectedMobs = {}

        local monstersFolder = workspace:FindFirstChild("Debris") and workspace.Debris:FindFirstChild("Monsters")
        if not monstersFolder then
            AutoFarmMobsListDropdown:Refresh({"None"})
            return
        end

        for _, mob in pairs(monstersFolder:GetChildren()) do
            if mob and mob:IsA("Model") then
                local mobsname = mob:GetAttribute("Title")
                local mobsrank = mob:GetAttribute("Rank")
                if not mobsname or mobsname == "" then
                    mobsname = mob.Name
                end

                local mobsdisplayname
                if mobsrank and mobsrank ~= "" then
                    mobsdisplayname = string.format("[%s] %s", mobsrank, mobsname)
                else
                    mobsdisplayname = mobsname
                end

                if not mobMap[mobsdisplayname] then
                    mobMap[mobsdisplayname] = {}
                    table.insert(mobNames, mobsdisplayname)
                end
                table.insert(mobMap[mobsdisplayname], mob)
            end
        end

        if #mobNames == 0 then
            AutoFarmMobsListDropdown:Refresh({"None"})
        else
            AutoFarmMobsListDropdown:Refresh(mobNames)
        end

        AutoFarmMobsListDropdown.CurrentOption = {"None"}
    end,
})

-- âœ… ä¸» Auto Farm é€»è¾‘
local AutoFarmToggle = FarmTab:CreateToggle({
    Name = "Auto Farm",
    CurrentValue = false,
    Flag = "AutoFarm1",
    Callback = function(Value)
        if Value then
            getgenv().AutoFarmRunning = true
            getgenv().FarmTargetChanged = true

            task.spawn(function()
                while getgenv().AutoFarmRunning do
                    if getgenv().FarmTargetChanged then
                        getgenv().FarmTargetChanged = false
                    end

                    local player = game.Players.LocalPlayer
                    local char = player.Character
                    local hrp = char and char:FindFirstChild("HumanoidRootPart")
                    if not hrp then
                        task.wait(1)
                        continue
                    end

                    local monstersFolder = workspace:FindFirstChild("Debris") and workspace.Debris:FindFirstChild("Monsters")
                    if monstersFolder then
                        mobMap = {}
                        for _, mob in pairs(monstersFolder:GetChildren()) do
                            if mob and mob:IsA("Model") then
                                local mobsname = mob:GetAttribute("Title") or mob.Name
                                local mobsrank = mob:GetAttribute("Rank")
                                local mobsdisplayname = mobsrank and mobsrank ~= "" and string.format("[%s] %s", mobsrank, mobsname) or mobsname
                                if not mobMap[mobsdisplayname] then
                                    mobMap[mobsdisplayname] = {}
                                end
                                table.insert(mobMap[mobsdisplayname], mob)
                            end
                        end
                    end

                    -- è‡ªåŠ¨æ‰“æ€ªå¾ªç¯
                    for _, mobName in ipairs(selectedMobs) do
                        if not getgenv().AutoFarmRunning or getgenv().FarmTargetChanged then break end

                        local mobList = mobMap[mobName]
                        if mobList and #mobList > 0 then
                            for _, mob in ipairs(mobList) do
                                if not getgenv().AutoFarmRunning or getgenv().FarmTargetChanged then break end
                                if mob and mob.Parent then
                                    local mobHRP = mob:FindFirstChild("HumanoidRootPart")
                                    if mobHRP then
                                        hrp.CFrame = mobHRP.CFrame + Vector3.new(0, 0, 2)

                                        -- âœ… å®æ—¶æ£€æµ‹å…³é—­æˆ–ç›®æ ‡å˜åŒ–ï¼Œç«‹å³ break
                                        while mob.Parent and getgenv().AutoFarmRunning and not getgenv().FarmTargetChanged do
                                            task.wait(0.1)
                                        end
                                        if not getgenv().AutoFarmRunning or getgenv().FarmTargetChanged then
                                            break
                                        end
                                    end
                                end
                            end
                        end
                    end

                    task.wait(0.1)
                end
            end)
        else
            getgenv().AutoFarmRunning = false
            getgenv().FarmTargetChanged = true -- âœ… å¼ºåˆ¶ä¸­æ–­å½“å‰ mob
        end
    end,
})


--ğŸŒŒ Auto Dungeon Tab
local AutoDungeonTab = Window:CreateTab("ğŸ° | Dungeon", nil)
local AutoDungeonSection = AutoDungeonTab:CreateSection("Dungeon Selection")

-- å…¨å±€å˜é‡
getgenv().SelectedDungeons = {}
getgenv().AutoDungeonEnabled = false
getgenv().AutoDungeonFarmRunning = false

local player = game.Players.LocalPlayer

-- âœ… Dungeon é€‰é¡¹
local DungeonOptions = {
    "Dungeon Easy",
    "Dungeon Medium",
    "Dungeon Hard",
    "Dungeon Insane",
    "Dungeon Crazy",
    "Dungeon Nightmare",
    "Leaf Raid",
}

-- âœ… é€‰æ‹© Dungeonï¼ˆå¤šé€‰ï¼‰
local SelectDungeonDropdown = AutoDungeonTab:CreateDropdown({
    Name = "Select Dungeons",
    Options = DungeonOptions,
    CurrentOption = {"Dungeon Easy"},
    MultipleOptions = true,
    Flag = "DungeonSelect1",
    Callback = function(Options)
        getgenv().SelectedDungeons = Options
        print("[DEBUG] ğŸ° å·²é€‰æ‹©å‰¯æœ¬:", table.concat(Options, ", "))
    end,
})

-- âœ… å¼€å…³
local AutoDungeonToggle = AutoDungeonTab:CreateToggle({
    Name = "Auto Join Dungeon + Auto Farm",
    CurrentValue = false,
    Flag = "AutoJoinDungeon1",
    Callback = function(Value)
        getgenv().AutoDungeonEnabled = Value
        if Value then
            print("[DEBUG] ğŸŸ¢ Auto Dungeon Enabled")
        else
            print("[DEBUG] ğŸ”´ Auto Dungeon Disabled")
        end
    end,
})

-- âœ… è‡ªåŠ¨å‰¯æœ¬å†…æ‰“æ€ªé€»è¾‘
local function startDungeonAutoFarm()
    if getgenv().AutoDungeonFarmRunning then return end
    getgenv().AutoDungeonFarmRunning = true

    task.spawn(function()
        print("[DEBUG] âš”ï¸ å¼€å§‹å‰¯æœ¬è‡ªåŠ¨æ‰“æ€ª")

        local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        if not hrp then
            repeat task.wait(1) until player.Character and player.Character:FindFirstChild("HumanoidRootPart")
            hrp = player.Character.HumanoidRootPart
        end

        while getgenv().AutoDungeonEnabled and getgenv().AutoDungeonFarmRunning do
            local monstersFolder = workspace:FindFirstChild("Debris") and workspace.Debris:FindFirstChild("Monsters")
            if monstersFolder then
                local mobs = monstersFolder:GetChildren()

                for _, mob in ipairs(mobs) do
                    if not getgenv().AutoDungeonEnabled or not getgenv().AutoDungeonFarmRunning then break end
                    if mob and mob:IsA("Model") and mob:FindFirstChild("HumanoidRootPart") then
                        local mobHRP = mob.HumanoidRootPart
                        print("[DEBUG] ğŸ§© Teleporting to mob:", mob.Name)
                        hrp.CFrame = mobHRP.CFrame + Vector3.new(0, 0, 2)

                        -- ç­‰å¾…æ€ªè¢«ç§»é™¤ï¼ˆæ‰“æ­»ï¼‰
                        repeat
                            task.wait(0.1)
                        until not mob.Parent or not getgenv().AutoDungeonFarmRunning
                    end
                end
            end

            task.wait(0.1) -- ç­‰0.5ç§’å†æ£€æŸ¥æ–°æ€ª
        end
        print("[DEBUG] ğŸ›‘ å‰¯æœ¬è‡ªåŠ¨æ‰“æ€ªç»“æŸ")
    end)
end

-- âœ… ç›‘å¬æ¸¸æˆå¹¿æ’­ï¼Œæ¯æ¬¡ç³»ç»Ÿè¯´ Dungeon å¼€å¯å°±è‡ªåŠ¨è¿›å…¥
local remote = game:GetService("ReplicatedStorage"):WaitForChild("Events"):WaitForChild("To_Client")

remote.OnClientEvent:Connect(function(data)
    if not getgenv().AutoDungeonEnabled then return end
    if type(data) ~= "table" then return end
    if data.Action ~= "System_Message" then return end
    if not data.Text or data.Text.Type ~= "Dungeon_Message" then return end

    local message = data.Text.Text or ""

    for _, dungeon in ipairs(getgenv().SelectedDungeons or {}) do
        if string.find(message, dungeon) then
            local dungeonName = dungeon:gsub(" ", "_")
            print("[DEBUG] âš”ï¸ æ£€æµ‹åˆ°å‰¯æœ¬å¼€å¯:", dungeon)

            -- âœ… è¿›å…¥å‰¯æœ¬
            game:GetService("ReplicatedStorage").Events.To_Server:FireServer({
                ["Action"] = "_Enter_Dungeon",
                ["Name"] = dungeonName,
            })

            print("[DEBUG] âœ… å·²è‡ªåŠ¨è¿›å…¥å‰¯æœ¬:", dungeonName)

            -- å»¶è¿Ÿå‡ ç§’åå¯åŠ¨æ‰“æ€ª
            task.delay(3, function()
                startDungeonAutoFarm()
            end)
        end
    end
end)
